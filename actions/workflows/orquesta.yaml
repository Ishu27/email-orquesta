---
version: '1.0'
description: A workflow to process an github deployment event and install a pack if the environment matches.
vars:
  - Subcription_id: 2f50f202-0a84-4c8c-a929-fcc5a3174590
  - Group_Name: {{trigger.group}}
  - Location: {{trigger.location}}
  - VM_Name: {{trigger.vmname}}
  - Client_Id: 7aae3fd9-9324-463f-89f5-7c4144971bfb
  - Secret: MJOJszdQ2fl]xYQQ5Lm+]hAM2vgR0e+5
  - Tenant_Id: d5656af4-b7b3-45b9-9346-fb0547921fb7
  - from: {{trigger.from}}
tasks:
  create_vm:
    action: email123.create_vm
    input:      
      Subcription_id: <% ctx().Subcription_id %>
      Location: <% ctx().Location %>
      VM_Name: <% ctx().VM_Name %>
      Client_Id: <% ctx().Client_Id %>
      Secret: <% ctx().Secret %>
      Tenant_Id: <% ctx().Tenant_Id %>
    next:
      - when: <% succeeded() %>
        do:
          - send_mail
      - when: <% failed() %>
        do:
          - work_failed
  send_mail:
    action: email123.send_email
      input:      
        email_to : <% ctx().from %>     
    next:
      - when: <% succeeded() %>
        do:
          - work_success
      - when: <% failed() %>
        do:
          - work_failed
  work_success:
    action: core.local
    input:
      cmd: echo compleated
      state: success
      description: Completed workflow
  work_failed:
    action: core.local
    input:
      cmd: echo failed 
      state: failure
      description: Failed workflow
